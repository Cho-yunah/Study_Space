# JWT (JSON Web Token)

[TOC]

## 1. JSON Web Token 이란?

- 정보를 JSON객체로 안전하게 전송하기 위한 표준 방법으로, 현대 웹서비스에서 사용자들의 인증 작업을 처리하는 가장 좋은 방법이다.
- Json 포맷을 이용하여 사용자에 대한 속성을 저장하는 claim 기반의 web token이다. self-contained 방식으로 필요한 모든 정보를 자체적으로 지니고 있으며, 토큰이 검증됐다는 것을 증명하는 signature 를 포함하고 있어서 정보를 안전하게 전달한다.



## 2. JWT의 사용

1. Authorization (회원 인증)

   : JWT를 가장 일반적으로 사용하는 사용처다. 사용자가 로그인하면 이후의 각 요청에는 JWT가 포함되어 사용자가 해당 토큰으로 허용되는 경로, 서비스 및 리소스에 엑세스 할 수 있다.

   유저의 세션을 유지할 필요없이 유저의 요청시에 토큰만 확인하면 되므로, 세션관리가 필요없어서 서버자원을 아낄수 있다.

2. 정보 교환

   : JSON 웹 토큰은 당사자 간에 정보를 안전하게 전송하는 좋은 방법이다. public 또는 privit 키 쌍을 사용하여 JWT에 서명 할 수 있으므로 해당 조건에 맞는 사람인지 확인할 수 있다. 또한 서명은 헤더와 페이로드를 사용하여 계산되므로 콘텐츠가 변조되지 않았는지 확인할 수 있다.



## 3. JWT의 구조

`.` 을 구분으로 하여 3가지로 나눠져서 구성된다.

```jsx
aaaaa.bbbbb.cccccc  // => 헤더. 내용. 서명
```

1. 헤더(Header) ⇒ typ: 토큰의 타입을 지정한다. `JWT` , alg: 해싱 알고리즘을 지정하여 토큰을 검증할 때 사용한다.
2. 내용(payload) ⇒ payload 부분에는 토큰에 담을 정보가 들어있다. 여기에 담는 정보의 한 '조각'을 클레임(claim)이라고 부르고, 이는 name/value한쌍으로 이뤄져있고 여러개의 클레임을 토큰에 넣을 수 있다.
   - 1. 등록된 클레임: 토큰에 대한 정보를 담기위해 이름이 정해진 클레임이다. 선택적으로 사용할 수 있다.
   - 1. 공개 클레임: 충돌이 방지된 이름을 갖고 있어야 하며, URI 형식으로 이름을 짓는다.
   - 1. 비공개 클레임:  클라이언트와 서버가 소통하기 위해 사용되는 클레임 이름이다.
3. 서명(signature) ⇒ 서명은 헤더의 인코딩값과 정보의 인코딩값을 합친 후 주어진 비밀키로 해쉬를 하여 생성한다.



## 4. JWT의 작동 방식

- JWT는 토큰 기반의 인증 시스템에서 사용되는데, 이 시스템은 인증받은 사용자들에게 토큰을 발급하고, 서버에 요청을 할 때 헤더에 토큰을 함께 보내도록 하여 유효성 검사를 하는 방식의 시스템이다.
- 작동 방법은 아래와 같다.
  1. 사용자가 아이디와 비밀번호로 로그인을 한다.
  2. 서버 측에서 해당 정보를 검증한다.
  3. 정보가 정확하면, 서버측에서 사용자에게 서명된 토큰을 발급한다.
  4. 클라이언트 측에서 전달받은 토큰을 저장해두고, 서버에 요청을 할 때마다 해당 토큰을 서버에 함께 전달한다. 이때
  5. 서버는 토큰을 검증하고, 요청에 응답한다.
- 로그인시 발급되는 이 토큰은 자격 증명이므로 보안에 주의를 기울여야 한다. 보안 부족으로 인해 민감한 세션 데이터를 브라우저 저장소에 저장해서는 안된다.